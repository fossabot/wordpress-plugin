function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n,i=0;i<e.length;i++)(n=e[i]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(t,e){var n=Math.max,i=Math.abs;if(null==this)throw new TypeError('"this" is null or not defined');var s,a,r=Object(this),o=r.length>>>0;if(0===o)return!1;for(var c=0|e,l=n(0<=c?c:o-i(c),0);l<o;){if((s=r[l])===(a=t)||"number"==typeof s&&"number"==typeof a&&isNaN(s)&&isNaN(a))return!0;l++}return!1}}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var i=arguments[1],s=0;s<n;){var a=e[s];if(t.call(i,a,s,e))return a;s++}},configurable:!0,writable:!0}),document.addEventListener("DOMContentLoaded",function(){function n(){this.style.setProperty("--value","".concat(function(){var t=this.max||100,e=this.min||0;return(this.value-e)/(t-e)*100}.call(this),"%"))}function i(e){"function"==typeof e.set||(n.call(e),t.forEach(function(t){e.addEventListener(t,n,!1)}),Object.defineProperty(e,"set",{value:function(t){null!==t&&"number"==typeof t&&(this.value=t),n.call(this)}}))}function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document.body,e='input[type="range"]';t instanceof HTMLElement&&(t.matches(e)&&(t=t.parentNode),Array.from(t.querySelectorAll(e)).forEach(i))}if("WebkitAppearance"in document.documentElement.style&&Array.from){var t=["input","change","update"];new MutationObserver(function(t){t.forEach(function(t){t.addedNodes.forEach(function(t){e(t)})})}).observe(document.body,{childList:!0,subtree:!0}),e()}}),function(n){n&&(n.expr.filters.loaded=function(t){var e=n(t);if(e.is("img"))return t.complete||"complete"===t.readyState||4===t.readyState||0!==t.naturalHeight;if(e.is("iframe"))try{return"complete"===(t.contentDocument||t.contentWindow.document).readyState}catch(t){return!1}return!1})}(jQuery),document.addEventListener("focusout",function(t){t.target.classList.remove("tab-focus")}),document.addEventListener("keydown",function(t){9!==t.keyCode||window.setTimeout(function(){document.activeElement.classList.add("tab-focus")},0)}),function(i){var t=function(){"use strict";function t(){_classCallCheck(this,t),this.selectors={container:".js-tab-container",tab:'[role="tab"]',panel:'[role="tabpanel"]'}}return _createClass(t,[{key:"show",value:function(t){var e=t.parents(this.selectors.container),n=i("#".concat(t.attr("aria-controls")));i(this.selectors.tab,e).attr("aria-selected","false"),t.attr("aria-selected","true"),i(this.selectors.panel,e).attr("aria-hidden","true"),n.attr("aria-hidden","false")}},{key:"handleClick",value:function(t){t.preventDefault(),this.show(i(t.target))}},{key:"handleKey",value:function(t){if([37,39].includes(t.which)){var e=i(t.target);if("true"===e.attr("aria-selected")){var n=e.parent("li")[39===t.which?"next":"prev"]("li").find(this.selectors.tab);n&&(n.focus(),this.show(n))}}}},{key:"build",value:function(){var e=this,t="".concat(this.selectors.container," ").concat(this.selectors.tab);i(document.body).on("click",t,function(t){e.handleClick(t)}).on("keydown",t,function(t){e.handleKey(t)})}}]),t}();i(function(){(new t).build()})}(jQuery),function(a){var r=function(t,e){t.attr("hidden",e),t.find(":input").prop("disabled",e)},t=function(){"use strict";function e(t){_classCallCheck(this,e),this.$form=t,this.selectors={type:".embed-type select",width:".embed-width :checkbox",colorPicker:".js-color-picker",productList:".js-product-list"},this.init(),this.listeners()}return _createClass(e,[{key:"listeners",value:function(){var t=this;this.$form.on("change",this.selectors.type,function(){return t.setType()}),this.$form.on("input",this.selectors.width,function(){return t.setWidth()})}},{key:"init",value:function(){this.setType(),this.setWidth(),this.setupColorPickers(),this.setupProductList()}},{key:"setupColorPickers",value:function(){this.$form.find(this.selectors.colorPicker).each(function(t,e){var n=a(e);n.hasClass("has-colorpicker")||n.addClass("has-colorpicker").wpColorPicker().removeClass("wp-color-picker")})}},{key:"setupProductList",value:function(){var t=this.$form.find(this.selectors.productList);t.length&&new window.SelzProductList(t).fetch()}},{key:"setType",value:function(){var s=this.$form.find(this.selectors.type).val();this.$form.find("[data-type]").each(function(t,e){var n=a(e),i=n.data("type").split(",");r(n,!i.includes(s))})}},{key:"setWidth",value:function(){var t=this.$form.find('[name="auto_width"]').is(":checked"),e=this.$form.find('[name="fluid_width"]'),n=e.is(":checked"),i=this.$form.find('[name="width"]');r(e.parent(".control"),t),r(i.parent(".control"),t||n)}}]),e}();window.SelzForm=t}(jQuery),function(r){var e=function(){"use strict";function t(){_classCallCheck(this,t),this.$element=r(".selz-modal"),this.$element.length&&(this.$backdrop=r(".selz-modal-backdrop"),this.$controls=r(".selz-modal-controls"),this.$close=r('[data-modal="close"]'),this.$form=this.$element.find("form"),this.$submit=this.$form.find(":submit"),this.loading=!1,this.shown=!1,this.listeners())}return _createClass(t,[{key:"enforceFocus",value:function(){var e=this;r(document).off("focusin.modal").on("focusin.modal",function(t){e.$element[0]===t.target||e.$element.has(t.target).length||e.$element.trigger("focus")})}},{key:"validate",value:function(){var t=!(!this.$form.get(0).checkValidity()||!this.$form.find('[name="link"]:checked').length);return this.$submit.prop("disabled",!t),t}},{key:"setKind",value:function(t){this.$kind||(this.$kind=r("<input>").attr({type:"hidden",name:"kind"}).appendTo(this.$form)),this.$kind.val(t)}},{key:"listeners",value:function(){var e=this;this.$form.on("input change click",function(){e.validate()}),this.$form.on("input change",'input[type="range"]',function(t){var e=r(t.target);r('output[for="'.concat(e.attr("id"),'"]')).prop("value",e.val())}),this.$close.on("click",function(t){t.preventDefault(),e.hide()}),this.$form.on("submit",function(t){t.preventDefault(),e.insert()}),r(document).on("keyup",function(t){27!==t.keyCode||e.hide()})}},{key:"load",value:function(){var e=this,t=window,n=t.ajaxurl,i=t.selzvars,s=i.action,a=i.nonce;this.loading||"string"!==r.type(n)||!n.length||(this.loading=!0,this.$submit.prop("disabled",!0),r.post(n,{action:s,nonce:a,data:this.$form.serialize()},function(t){e.$controls.html(t),e.loading=!1,e.form=new window.SelzForm(e.$form),e.validate()}))}},{key:"hide",value:function(){this.shown&&(this.shown=!1,this.$backdrop.attr("hidden",!this.shown),this.$element.attr("hidden",!this.shown))}},{key:"show",value:function(t){this.shown||!window.wpActiveEditor||(this.setKind(t),r(".selz-modal-controls").html('\n                <div class="text-center padding-6">\n                    <span class="loader" aria-hidden="true"></span>\n                    <p class="margin-0 margin-top-2">Loading&hellip;</p>\n                </div>\n            '),this.shown=!0,this.$backdrop.attr("hidden",!this.shown),this.$element.attr("hidden",!this.shown),this.$close.focus(),this.load(),this.enforceFocus())}},{key:"insert",value:function(){if(window.tinymce&&this.validate()){this.hide();var t=this.$form.serializeArray(),e=t.find(function(t){return"type"===t.name}),n=["kind"];"store"===e?n.push("action","button_text","show_description","show_logos","interact","link","width","auto_width","fluid_width"):(n.push("store_link","link_color"),"button"===e?n.push("show_description"):"widget"===e&&n.push("auto_width"));var i=t.filter(function(t){return!n.includes(t.name)}).map(function(t){var e=t.name,n=t.value;return"fluid_width"===e&&(e="width",n="100%"),"".concat(e,'="').concat(n,'"')}).join(" "),s="[".concat(window.selzvars.slug," ").concat(i,"]");window.tinymce.get(window.wpActiveEditor)&&(window.tinymce.execCommand("mceBeginUndoLevel"),window.tinymce.execCommand("mceInsertContent",!1,s),window.tinymce.execCommand("mceEndUndoLevel")),window.edInsertContent("",s)}}}]),t}();r(function(){var t=r(".js-open-modal");if(t.length){var i=new e;t.each(function(t,e){var n=r(e);n.on("click",function(){i.show(n.data("type"))})})}})}(jQuery),function(s){s(document).on("ready widget-added widget-updated",function(){s(".widgets-sortables > div").each(function(t,e){var n=s(e),i=n.attr("id");void 0!==i&&-1!==i.indexOf("selz")&&(n.selzForm=new window.SelzForm(n.find("form")))})})}(jQuery),function(s){var a=function(){},e=function(){"use strict";function i(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:a;_classCallCheck(this,i),this.request=t,this.timestamp=Date.now(),this.callback=e,this.fail=n}return _createClass(i,[{key:"send",value:function(){var i=this;s.ajax(this.request).then(function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return i.callback.apply(i,[i].concat(e))}).fail(function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return i.fail.apply(i,[i].concat(e))})}}]),i}(),t=function t(e,n,i){"use strict";_classCallCheck(this,t),this.number=e,this.start=n,this.end=i},n=function(){"use strict";function n(t,e){_classCallCheck(this,n),this.$element=t,this.$list=t.find(".product-list"),this.$search=t.find('[type="search"]'),this.$pager=t.find(".product-pager"),this.$previous=this.$pager.find('[data-page="previous"]'),this.$next=this.$pager.find('[data-page="next"]'),this.searchTimer=null,this.inputName=t.data("input-name"),this.selected=t.data("selected"),this.request=null,this.resetPager(),this.query=null,this.last=null,this.config=s.extend(!0,{limit:50,classNames:{landscape:"is-landscape",portrait:"is-portrait",square:"is-square",loading:"is-loading"}},e),this.listeners()}return _createClass(n,[{key:"listeners",value:function(){var e=this;this.$search.on("input",function(t){window.clearTimeout(e.searchTimer),e.searchTimer=window.setTimeout(function(){e.query=s(t.target).val(),e.resetPager(),e.fetch()},500)}),this.$list.on("input",":radio",function(){e.selected=e.$list.find(":checked").val()}),this.$previous.on("click",function(){return e.previous()}),this.$next.on("click",function(){return e.next()})}},{key:"loadImages",value:function(){var a=this,i=function(t){return t.addClass((e=t,n=e.get(0),i=n.naturalWidth,s=n.naturalHeight,i&&s?s<i?a.config.classNames.landscape:i<s?a.config.classNames.portrait:s===i?a.config.classNames.square:"":"")).removeClass(a.config.classNames.loading);var e,n,i,s};this.$list.find("img").each(function(t,e){var n=s(e);n.is(":loaded")?i(n):n.on("load error",function(){return i(n)})})}},{key:"map",value:function(t){var r=this;if(!t||!t.length){var e=this.searching?"No matches found":"No products found";return'<li class="padding-6 text-center color-light">'.concat(e,"</li>")}return t.map(function(t){var e;e=t.featured_image?t.featured_image.small:"https://placehold.it/100x100";var n=r.config.classNames.loading,i=r.inputName,s=t.short_url,a=r.selected===s?"checked":"";return'\n                        <li>\n                            <label class="product-list-item">\n                                <input type="radio" name="'.concat(i,'" value="').concat(s,'" required ').concat(a,'>\n                                <span class="').concat("media-ratio-1-1 media-placeholder product-image",'" role="presentation">\n                                    <img src=\'').concat(e,"' alt='' class=\"").concat(n,'">\n                                </span>\n                                <span class="product-info">\n                                    ').concat(t.title,"\n                                    \x3c!-- ").concat(t.price&&"<small>".concat(t.price,"</small>")," --\x3e\n                                </span>\n                            </button>\n                        </li>\n                    ")}).join("")}},{key:"render",value:function(){this.$list.html(this.map(this.products)),this.loadImages(),this.$pager.attr("hidden",!this.hasMore&&1===this.page.number),this.$next.attr("disabled",!this.hasMore),this.$previous.attr("disabled",1===this.page.number)}},{key:"previous",value:function(){var t=this.pages[this.page.number-1];t&&(this.start=t.start,this.page=t,this.fetch())}},{key:"next",value:function(){this.start=this.page.end,this.page=new t(this.page.number+1),this.fetch()}},{key:"resetPager",value:function(){this.start=null,this.page=new t(1),this.pages={},this.hasMore=!1}},{key:"fetch",value:function(){var n=this,t=window.ajaxurl;"string"===s.type(t)&&t.length&&(this.$list.html('\n                <li class="padding-6 text-center">\n                    <span class="loader" aria-hidden="true"></span>\n                    <p class="margin-0 margin-top-2 color-light">Loading&hellip;</p>\n                <li>\n            '),this.$pager.attr("hidden",!0),this.request=new e({url:t,method:"GET",dataType:"json",data:{action:this.searching?"selz_search_products":"selz_get_products",starting_after:1===this.page.number?null:this.start,page:this.page.number,q:this.query}},function(t,e){t.timestamp!==n.request.timestamp||(n.products=e.data,n.hasMore=e.has_more,n.products&&n.products.length&&(n.page.start=n.products[0].id,n.page.end=n.products[n.products.length-1].id),n.pages[n.page.number]=n.page,n.render())},function(){n.$list.html('<li class="padding-6 text-center color-light">Failed to load products. Please try again.</li>')}),this.request.send())}},{key:"searching",get:function(){return!("string"!==s.type(this.query)||!this.query.length)}}]),n}();window.SelzProductList=n}(jQuery);